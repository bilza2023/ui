{"version":3,"file":"_server-IlCHyN2d.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/admin/settings/_server.js"],"sourcesContent":["import { fail, json } from \"@sveltejs/kit\";\nimport { mkdir, writeFile, access } from \"fs/promises\";\nimport { constants } from \"fs\";\nimport { join, basename } from \"path\";\nimport { d as private_env } from \"../../../../chunks/shared-server.js\";\nconst ASSETS_ROOT = private_env.ASSETS_DIR || join(process.cwd(), \"assets\");\nconst ALLOWED = {\n  images: [\".png\", \".jpg\", \".jpeg\", \".webp\", \".gif\", \".svg\"],\n  sounds: [\".mp3\", \".wav\", \".ogg\", \".opus\"]\n};\nasync function POST({ request }) {\n  const form = await request.formData();\n  const target = String(form.get(\"target\") || \"\");\n  if (![\"images\", \"sounds\"].includes(target)) {\n    return fail(400, { ok: false, error: \"Invalid target\" });\n  }\n  const files = form.getAll(\"files\").filter(Boolean);\n  if (!files.length) return fail(400, { ok: false, error: \"No files\" });\n  const dir = join(ASSETS_ROOT, target);\n  await mkdir(dir, { recursive: true });\n  const results = [];\n  for (const file of files) {\n    const name = sanitizeName(file.name || \"upload\");\n    const ext = (name.match(/\\.[^.]+$/)?.[0] || \"\").toLowerCase();\n    if (!ALLOWED[target].includes(ext)) {\n      results.push({ name, ok: false, error: `Disallowed extension ${ext}` });\n      continue;\n    }\n    const finalName = await dedupe(dir, name);\n    const buf = Buffer.from(await file.arrayBuffer());\n    await writeFile(join(dir, finalName), buf);\n    results.push({\n      ok: true,\n      name: finalName,\n      // public URL your app will use:\n      url: `/media/${target}/${finalName}`\n    });\n  }\n  return json({ ok: true, count: results.length, results });\n}\nfunction sanitizeName(n) {\n  n = basename(n).trim().toLowerCase();\n  n = n.replace(/\\s+/g, \"-\").replace(/[^a-z0-9._-]/g, \"\");\n  return n || \"file\";\n}\nasync function dedupe(dir, name) {\n  const [base, ext = \"\"] = splitExt(name);\n  let attempt = name, i = 1;\n  while (await exists(join(dir, attempt))) {\n    attempt = `${base}-${i}${ext}`;\n    i++;\n  }\n  return attempt;\n}\nfunction splitExt(n) {\n  const i = n.lastIndexOf(\".\");\n  return i === -1 ? [n, \"\"] : [n.slice(0, i), n.slice(i)];\n}\nasync function exists(p) {\n  try {\n    await access(p, constants.F_OK);\n    return true;\n  } catch {\n    return false;\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}