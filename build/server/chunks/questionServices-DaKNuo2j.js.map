{"version":3,"file":"questionServices-DaKNuo2j.js","sources":["../../../.svelte-kit/adapter-node/chunks/questionServices.js"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\nconst prisma = new PrismaClient();\nasync function insertFullQuestionFromDeck({\n  filename,\n  name,\n  description,\n  tags,\n  status,\n  timed,\n  deck\n  // full AQuestion JSON object\n}) {\n  return await prisma.$transaction(async (tx) => {\n    await tx.question.upsert({\n      where: { filename },\n      update: { name, description, tags, status, timed, deck },\n      create: { filename, name, description, tags, status, timed, deck }\n    });\n    await tx.slideItem.deleteMany({ where: { slide: { questionFilename: filename } } });\n    await tx.slide.deleteMany({ where: { questionFilename: filename } });\n    for (let i = 0; i < deck.deck.length; i++) {\n      const slide = deck.deck[i];\n      const slideRec = await tx.slide.create({\n        data: {\n          questionFilename: filename,\n          index: i,\n          type: slide.type,\n          start: slide.start,\n          end: slide.end\n        }\n      });\n      for (let j = 0; j < slide.data.length; j++) {\n        const item = slide.data[j];\n        const {\n          name: itemName,\n          showAt = 0,\n          content,\n          label,\n          value,\n          color,\n          type: typeHint,\n          spItems,\n          ...rest\n        } = item;\n        let textContent = null;\n        let numValue = null;\n        if (typeof content === \"string\") {\n          textContent = content;\n        } else if (typeof content === \"number\") {\n          numValue = content;\n        } else ;\n        await tx.slideItem.create({\n          data: {\n            slideId: slideRec.id,\n            index: j,\n            name: itemName,\n            showAt,\n            textContent,\n            numValue,\n            label: label ?? null,\n            imageUrl: item.image ?? null,\n            colorHex: color ?? null,\n            typeHint: typeHint ?? null,\n            extraJson: {\n              ...spItems ? { spItems } : {},\n              ...rest\n            }\n          }\n        });\n      }\n    }\n    return { success: true };\n  });\n}\nasync function getQuestionByFilename(filename) {\n  return prisma.question.findUnique({ where: { filename } });\n}\nasync function getAllQuestions() {\n  return prisma.question.findMany({ orderBy: { createdAt: \"desc\" } });\n}\nasync function deleteQuestion(filename) {\n  return prisma.$transaction(async (tx) => {\n    await tx.slideItem.deleteMany({\n      where: { slide: { questionFilename: filename } }\n    });\n    await tx.slide.deleteMany({\n      where: { questionFilename: filename }\n    });\n    return tx.question.delete({ where: { filename } });\n  });\n}\nasync function updateDeckJson(filename, newDeckJson) {\n  return prisma.question.update({\n    where: { filename },\n    data: { deck: newDeckJson }\n  });\n}\nexport {\n  getAllQuestions as a,\n  deleteQuestion as d,\n  getQuestionByFilename as g,\n  insertFullQuestionFromDeck as i,\n  updateDeckJson as u\n};\n"],"names":[],"mappings":"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"}