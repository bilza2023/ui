{"version":3,"file":"synopsisServices-C-26dl2-.js","sources":["../../../.svelte-kit/adapter-node/chunks/synopsisServices.js"],"sourcesContent":["import { _ as __vite_glob_0_2, a as __vite_glob_0_1, b as __vite_glob_0_0 } from \"./index2.js\";\nconst synModules = /* @__PURE__ */ Object.assign({ \"../synopsis/fbise9mathold.js\": __vite_glob_0_0, \"../synopsis/fbise9physics.js\": __vite_glob_0_1, \"../synopsis/index.js\": __vite_glob_0_2 });\nconst _cache = {\n  loaded: false,\n  tcodes: [],\n  synopsisByTcode: {},\n  chapterNoByTcode: {},\n  // tcode -> chapterSlug -> number\n  chaptersByTcode: {},\n  exercisesByKey: {}\n  // `${tcode}::${chapterSlug}` -> exercises\n};\nfunction deriveChapterNumber(chapterName, chapterSlug, fallback) {\n  let m = /ch[\\s-]*0*([0-9]+)/i.exec(chapterName || \"\");\n  if (m) return parseInt(m[1], 10);\n  m = /^ch0*([0-9]+)/i.exec(chapterSlug || \"\");\n  if (m) return parseInt(m[1], 10);\n  return fallback;\n}\nfunction validateSynopsis(s) {\n  const errs = [];\n  if (!s || !s.tcodeName) errs.push(\"tcodeName missing\");\n  const seenChapterIds = /* @__PURE__ */ new Set();\n  (s.chapters ?? []).forEach((ch, i) => {\n    if (!ch?.name) errs.push(`chapter[${i}].name missing`);\n    if (!ch?.filename) errs.push(`chapter[${i}].filename missing`);\n    if (seenChapterIds.has(ch.filename)) errs.push(`duplicate chapter filename: ${ch.filename}`);\n    seenChapterIds.add(ch.filename);\n    const seenExerciseIds = /* @__PURE__ */ new Set();\n    (ch.exercises ?? []).forEach((ex, j) => {\n      if (!ex?.name) errs.push(`exercise[${i}.${j}].name missing`);\n      if (!ex?.filename) errs.push(`exercise[${i}.${j}].filename missing`);\n      if (seenExerciseIds.has(ex.filename)) errs.push(`duplicate exercise filename in chapter \"${ch.filename}\": ${ex.filename}`);\n      seenExerciseIds.add(ex.filename);\n    });\n  });\n  return { ok: errs.length === 0, errors: errs };\n}\nfunction prepareOnce() {\n  if (_cache.loaded) return;\n  const tcodes = [];\n  for (const [, mod] of Object.entries(synModules)) {\n    const raw = mod?.default;\n    if (!raw?.tcodeName) continue;\n    const v = validateSynopsis(raw);\n    if (!v.ok) console.warn(\"[synopsisServices] Validation issues:\", raw.tcodeName, v.errors);\n    const chapters = (raw.chapters ?? []).map((ch, idx) => {\n      const number = deriveChapterNumber(ch.name, ch.filename, idx + 1);\n      const exercises = (ch.exercises ?? []).map((ex, jdx) => ({\n        name: ex.name,\n        filename: ex.filename,\n        order: jdx\n      }));\n      return { name: ch.name, filename: ch.filename, number, order: idx, exercises };\n    });\n    const synopsis = {\n      tcodeName: raw.tcodeName,\n      description: raw.description ?? \"\",\n      image: raw.image ?? \"\",\n      chapters\n    };\n    _cache.synopsisByTcode[synopsis.tcodeName] = synopsis;\n    _cache.chaptersByTcode[synopsis.tcodeName] = chapters;\n    const chNoMap = {};\n    for (const ch of chapters) chNoMap[ch.filename] = ch.number;\n    _cache.chapterNoByTcode[synopsis.tcodeName] = chNoMap;\n    for (const ch of chapters) {\n      _cache.exercisesByKey[`${synopsis.tcodeName}::${ch.filename}`] = ch.exercises;\n    }\n    tcodes.push({ tcodeName: synopsis.tcodeName, description: synopsis.description, image: synopsis.image });\n  }\n  tcodes.sort((a, b) => a.tcodeName.localeCompare(b.tcodeName));\n  _cache.tcodes = tcodes;\n  _cache.loaded = true;\n}\nfunction listTcodes() {\n  prepareOnce();\n  return _cache.tcodes.slice();\n}\nfunction getChapters(tcode) {\n  prepareOnce();\n  const list = _cache.chaptersByTcode[tcode] || [];\n  return list.slice().sort((a, b) => a.order - b.order);\n}\nfunction getExercises(tcode, chapterSlug) {\n  prepareOnce();\n  const list = _cache.exercisesByKey[`${tcode}::${chapterSlug}`] || [];\n  return list.slice().sort((a, b) => a.order - b.order);\n}\nfunction chapterNo(tcode, chapterSlug) {\n  prepareOnce();\n  const map = _cache.chapterNoByTcode[tcode] || {};\n  const n = map[chapterSlug];\n  if (!n) throw new Error(`Unknown chapter slug for tcode \"${tcode}\": ${chapterSlug}`);\n  return n;\n}\nfunction resolvePath(tcode, chapterSlug, exerciseSlug) {\n  prepareOnce();\n  const syn = _cache.synopsisByTcode[tcode];\n  if (!syn) return { ok: false, status: 404, error: `Unknown tcode: ${tcode}` };\n  if (!chapterSlug) return { ok: true, tcode: syn.tcodeName, chapter: null, exercise: null };\n  const chapter = syn.chapters.find((c) => c.filename === chapterSlug);\n  if (!chapter) return { ok: false, status: 404, error: `Unknown chapter: ${chapterSlug}` };\n  if (!exerciseSlug) return { ok: true, tcode: syn.tcodeName, chapter, exercise: null };\n  const exercise = chapter.exercises.find((e) => e.filename === exerciseSlug);\n  if (!exercise) return { ok: false, status: 404, error: `Unknown exercise: ${exerciseSlug}` };\n  return { ok: true, tcode: syn.tcodeName, chapter, exercise };\n}\nexport {\n  getExercises as a,\n  chapterNo as c,\n  getChapters as g,\n  listTcodes as l,\n  resolvePath as r\n};\n"],"names":[],"mappings":";;AACA,MAAM,UAAU,mBAAmB,MAAM,CAAC,MAAM,CAAC,EAAE,8BAA8B,EAAE,eAAe,EAAE,8BAA8B,EAAE,eAAe,EAAE,sBAAsB,EAAE,eAAe,EAAE,CAAC;AAC/L,MAAM,MAAM,GAAG;AACf,EAAE,MAAM,EAAE,KAAK;AACf,EAAE,MAAM,EAAE,EAAE;AACZ,EAAE,eAAe,EAAE,EAAE;AACrB,EAAE,gBAAgB,EAAE,EAAE;AACtB;AACA,EAAE,eAAe,EAAE,EAAE;AACrB,EAAE,cAAc,EAAE;AAClB;AACA,CAAC;AACD,SAAS,mBAAmB,CAAC,WAAW,EAAE,WAAW,EAAE,QAAQ,EAAE;AACjE,EAAE,IAAI,CAAC,GAAG,qBAAqB,CAAC,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC;AACvD,EAAE,IAAI,CAAC,EAAE,OAAO,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC;AAClC,EAAE,CAAC,GAAG,gBAAgB,CAAC,IAAI,CAAC,WAAW,IAAI,EAAE,CAAC;AAC9C,EAAE,IAAI,CAAC,EAAE,OAAO,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC;AAClC,EAAE,OAAO,QAAQ;AACjB;AACA,SAAS,gBAAgB,CAAC,CAAC,EAAE;AAC7B,EAAE,MAAM,IAAI,GAAG,EAAE;AACjB,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC;AACxD,EAAE,MAAM,cAAc,mBAAmB,IAAI,GAAG,EAAE;AAClD,EAAE,CAAC,CAAC,CAAC,QAAQ,IAAI,EAAE,EAAE,OAAO,CAAC,CAAC,EAAE,EAAE,CAAC,KAAK;AACxC,IAAI,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC;AAC1D,IAAI,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,kBAAkB,CAAC,CAAC;AAClE,IAAI,IAAI,cAAc,CAAC,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,4BAA4B,EAAE,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC;AAChG,IAAI,cAAc,CAAC,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC;AACnC,IAAI,MAAM,eAAe,mBAAmB,IAAI,GAAG,EAAE;AACrD,IAAI,CAAC,EAAE,CAAC,SAAS,IAAI,EAAE,EAAE,OAAO,CAAC,CAAC,EAAE,EAAE,CAAC,KAAK;AAC5C,MAAM,IAAI,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,cAAc,CAAC,CAAC;AAClE,MAAM,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,kBAAkB,CAAC,CAAC;AAC1E,MAAM,IAAI,eAAe,CAAC,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,wCAAwC,EAAE,EAAE,CAAC,QAAQ,CAAC,GAAG,EAAE,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC;AAChI,MAAM,eAAe,CAAC,GAAG,CAAC,EAAE,CAAC,QAAQ,CAAC;AACtC,IAAI,CAAC,CAAC;AACN,EAAE,CAAC,CAAC;AACJ,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE;AAChD;AACA,SAAS,WAAW,GAAG;AACvB,EAAE,IAAI,MAAM,CAAC,MAAM,EAAE;AACrB,EAAE,MAAM,MAAM,GAAG,EAAE;AACnB,EAAE,KAAK,MAAM,GAAG,GAAG,CAAC,IAAI,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;AACpD,IAAI,MAAM,GAAG,GAAG,GAAG,EAAE,OAAO;AAC5B,IAAI,IAAI,CAAC,GAAG,EAAE,SAAS,EAAE;AACzB,IAAI,MAAM,CAAC,GAAG,gBAAgB,CAAC,GAAG,CAAC;AACnC,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,OAAO,CAAC,IAAI,CAAC,uCAAuC,EAAE,GAAG,CAAC,SAAS,EAAE,CAAC,CAAC,MAAM,CAAC;AAC7F,IAAI,MAAM,QAAQ,GAAG,CAAC,GAAG,CAAC,QAAQ,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,KAAK;AAC3D,MAAM,MAAM,MAAM,GAAG,mBAAmB,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,CAAC,QAAQ,EAAE,GAAG,GAAG,CAAC,CAAC;AACvE,MAAM,MAAM,SAAS,GAAG,CAAC,EAAE,CAAC,SAAS,IAAI,EAAE,EAAE,GAAG,CAAC,CAAC,EAAE,EAAE,GAAG,MAAM;AAC/D,QAAQ,IAAI,EAAE,EAAE,CAAC,IAAI;AACrB,QAAQ,QAAQ,EAAE,EAAE,CAAC,QAAQ;AAC7B,QAAQ,KAAK,EAAE;AACf,OAAO,CAAC,CAAC;AACT,MAAM,OAAO,EAAE,IAAI,EAAE,EAAE,CAAC,IAAI,EAAE,QAAQ,EAAE,EAAE,CAAC,QAAQ,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,EAAE,SAAS,EAAE;AACpF,IAAI,CAAC,CAAC;AACN,IAAI,MAAM,QAAQ,GAAG;AACrB,MAAM,SAAS,EAAE,GAAG,CAAC,SAAS;AAC9B,MAAM,WAAW,EAAE,GAAG,CAAC,WAAW,IAAI,EAAE;AACxC,MAAM,KAAK,EAAE,GAAG,CAAC,KAAK,IAAI,EAAE;AAC5B,MAAM;AACN,KAAK;AACL,IAAI,MAAM,CAAC,eAAe,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,QAAQ;AACzD,IAAI,MAAM,CAAC,eAAe,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,QAAQ;AACzD,IAAI,MAAM,OAAO,GAAG,EAAE;AACtB,IAAI,KAAK,MAAM,EAAE,IAAI,QAAQ,EAAE,OAAO,CAAC,EAAE,CAAC,QAAQ,CAAC,GAAG,EAAE,CAAC,MAAM;AAC/D,IAAI,MAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC,SAAS,CAAC,GAAG,OAAO;AACzD,IAAI,KAAK,MAAM,EAAE,IAAI,QAAQ,EAAE;AAC/B,MAAM,MAAM,CAAC,cAAc,CAAC,CAAC,EAAE,QAAQ,CAAC,SAAS,CAAC,EAAE,EAAE,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,EAAE,CAAC,SAAS;AACnF,IAAI;AACJ,IAAI,MAAM,CAAC,IAAI,CAAC,EAAE,SAAS,EAAE,QAAQ,CAAC,SAAS,EAAE,WAAW,EAAE,QAAQ,CAAC,WAAW,EAAE,KAAK,EAAE,QAAQ,CAAC,KAAK,EAAE,CAAC;AAC5G,EAAE;AACF,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;AAC/D,EAAE,MAAM,CAAC,MAAM,GAAG,MAAM;AACxB,EAAE,MAAM,CAAC,MAAM,GAAG,IAAI;AACtB;AACA,SAAS,UAAU,GAAG;AACtB,EAAE,WAAW,EAAE;AACf,EAAE,OAAO,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE;AAC9B;AACA,SAAS,WAAW,CAAC,KAAK,EAAE;AAC5B,EAAE,WAAW,EAAE;AACf,EAAE,MAAM,IAAI,GAAG,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC,IAAI,EAAE;AAClD,EAAE,OAAO,IAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC;AACvD;AACA,SAAS,YAAY,CAAC,KAAK,EAAE,WAAW,EAAE;AAC1C,EAAE,WAAW,EAAE;AACf,EAAE,MAAM,IAAI,GAAG,MAAM,CAAC,cAAc,CAAC,CAAC,EAAE,KAAK,CAAC,EAAE,EAAE,WAAW,CAAC,CAAC,CAAC,IAAI,EAAE;AACtE,EAAE,OAAO,IAAI,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC;AACvD;AACA,SAAS,SAAS,CAAC,KAAK,EAAE,WAAW,EAAE;AACvC,EAAE,WAAW,EAAE;AACf,EAAE,MAAM,GAAG,GAAG,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,IAAI,EAAE;AAClD,EAAE,MAAM,CAAC,GAAG,GAAG,CAAC,WAAW,CAAC;AAC5B,EAAE,IAAI,CAAC,CAAC,EAAE,MAAM,IAAI,KAAK,CAAC,CAAC,gCAAgC,EAAE,KAAK,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC,CAAC;AACtF,EAAE,OAAO,CAAC;AACV;AACA,SAAS,WAAW,CAAC,KAAK,EAAE,WAAW,EAAE,YAAY,EAAE;AACvD,EAAE,WAAW,EAAE;AACf,EAAE,MAAM,GAAG,GAAG,MAAM,CAAC,eAAe,CAAC,KAAK,CAAC;AAC3C,EAAE,IAAI,CAAC,GAAG,EAAE,OAAO,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,eAAe,EAAE,KAAK,CAAC,CAAC,EAAE;AAC/E,EAAE,IAAI,CAAC,WAAW,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,IAAI,EAAE;AAC5F,EAAE,MAAM,OAAO,GAAG,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,KAAK,WAAW,CAAC;AACtE,EAAE,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,iBAAiB,EAAE,WAAW,CAAC,CAAC,EAAE;AAC3F,EAAE,IAAI,CAAC,YAAY,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,SAAS,EAAE,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE;AACvF,EAAE,MAAM,QAAQ,GAAG,OAAO,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,QAAQ,KAAK,YAAY,CAAC;AAC7E,EAAE,IAAI,CAAC,QAAQ,EAAE,OAAO,EAAE,EAAE,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,kBAAkB,EAAE,YAAY,CAAC,CAAC,EAAE;AAC9F,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,SAAS,EAAE,OAAO,EAAE,QAAQ,EAAE;AAC9D;;;;"}