{"version":3,"file":"18-UjHIh8o1.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/player/_page.server.js","../../../.svelte-kit/adapter-node/nodes/18.js"],"sourcesContent":["import { p as prisma } from \"../../../chunks/prisma.js\";\nimport { i as isSubscribed } from \"../../../chunks/subscriptionServices.js\";\nimport { error, redirect } from \"@sveltejs/kit\";\nconst prerender = false;\nfunction getToken(cookies, request) {\n  const cookie = cookies.get(\"token\");\n  if (cookie) return cookie;\n  const auth = request.headers.get(\"authorization\");\n  if (auth && auth.startsWith(\"Bearer \")) return auth.slice(7);\n  return null;\n}\nasync function load({ url, cookies, request }) {\n  const filename = url.searchParams.get(\"filename\");\n  if (!filename) throw error(400, \"filename is required\");\n  const row = await prisma.question.findUnique({\n    where: { filename },\n    select: {\n      type: true,\n      deck: true,\n      name: true,\n      description: true,\n      status: true,\n      tags: true,\n      timed: true,\n      tcode: true,\n      chapter: true,\n      exercise: true,\n      editedAt: true,\n      createdAt: true\n    }\n  });\n  if (!row) throw error(404, `Deck \"${filename}\" not found`);\n  if (row.type !== \"deck\" || !row.deck) throw error(415, `Item \"${filename}\" is not a deck`);\n  const slides = Array.isArray(row.deck) ? row.deck : row.deck.deck ?? [];\n  if (!Array.isArray(slides) || slides.length === 0) {\n    throw error(422, `Deck \"${filename}\" has no slides`);\n  }\n  const token = getToken(cookies, request);\n  const authz = await isSubscribed(row.tcode ?? \"\", token);\n  if (!authz.allowed) {\n    const q = new URLSearchParams({\n      tcode: row.tcode ?? \"\",\n      filename,\n      reason: authz.reason ?? \"denied\"\n    }).toString();\n    throw redirect(302, `/sales?${q}`);\n  }\n  return {\n    meta: {\n      filename,\n      name: row.name ?? filename,\n      description: row.description ?? \"\",\n      status: row.status ?? null,\n      tags: row.tags ?? [],\n      timed: !!row.timed,\n      tcode: row.tcode,\n      chapter: row.chapter,\n      exercise: row.exercise,\n      editedAt: row.editedAt,\n      createdAt: row.createdAt\n    },\n    deckRaw: row.deck,\n    authz\n    // { allowed, reason, userId, tcode, expiresAt, remainingDays }\n  };\n}\nexport {\n  load,\n  prerender\n};\n","import * as server from '../entries/pages/player/_page.server.js';\n\nexport const index = 18;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/player/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/player/+page.server.js\";\nexport const imports = [\"_app/immutable/nodes/18.BsJArWgA.js\",\"_app/immutable/chunks/C5V-7dkx.js\",\"_app/immutable/chunks/IHki7fMi.js\",\"_app/immutable/chunks/qvxQi2uu.js\",\"_app/immutable/chunks/DF3-wX0J.js\",\"_app/immutable/chunks/C16nyjQn.js\",\"_app/immutable/chunks/_072e-m6.js\",\"_app/immutable/chunks/CXNmKXog.js\"];\nexport const stylesheets = [\"_app/immutable/assets/Comment.RpbiVNIT.css\",\"_app/immutable/assets/player_utility.DgnDj83M.css\",\"_app/immutable/assets/18.DJCTMJHy.css\",\"_app/immutable/assets/tables.B1wubMX-.css\"];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}