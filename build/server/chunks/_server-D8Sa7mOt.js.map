{"version":3,"file":"_server-D8Sa7mOt.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/admin/uploadNotes/_server.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { e as exists, c as createQuestion } from \"../../../../chunks/questionServices.js\";\nasync function POST({ request }) {\n  const form = await request.formData();\n  const tcode = (form.get(\"tcode\") ?? \"\").toString().trim();\n  const chapStr = (form.get(\"chapter\") ?? \"\").toString().trim();\n  const exercise = (form.get(\"exercise\") ?? \"\").toString().trim();\n  if (!tcode || !chapStr || !exercise) {\n    return json({ error: \"Missing required path fields\" }, { status: 400 });\n  }\n  const chapter = Number.parseInt(chapStr, 10);\n  if (Number.isNaN(chapter)) return json({ error: \"Chapter must be integer\" }, { status: 400 });\n  const statusOverride = (form.get(\"status\") ?? \"\").toString().trim() || void 0;\n  const descriptionOverride = (form.get(\"description\") ?? \"\").toString().trim() || void 0;\n  const tagsCsv = (form.get(\"tags\") ?? \"\").toString();\n  const tagsOverride = tagsCsv ? tagsCsv.split(\",\").map((s) => s.trim()).filter(Boolean) : void 0;\n  const file = form.get(\"file\");\n  if (!file) return json({ error: \"No file uploaded\" }, { status: 400 });\n  const originalName = file.name;\n  const baseName = form.get(\"filename\")?.toString().trim() || originalName.replace(/\\.(html|htm)$/i, \"\");\n  if (!baseName) return json({ error: \"Unable to determine filename\" }, { status: 400 });\n  if (await exists(baseName)) {\n    return json({ error: \"Filename already exists. Delete it first or choose a new filename.\" }, { status: 409 });\n  }\n  try {\n    const noteText = await file.text();\n    if (!noteText.trim()) {\n      return json({ error: \"Note file is empty\" }, { status: 400 });\n    }\n    await createQuestion({\n      filename: baseName,\n      type: \"note\",\n      // <-- important: mark it as a note\n      tcode,\n      chapter,\n      exercise,\n      name: descriptionOverride || baseName,\n      description: descriptionOverride ?? null,\n      tags: tagsOverride ?? [],\n      status: statusOverride ?? \"ready\",\n      note: noteText\n    });\n    return json({ success: true, uploaded: 1 });\n  } catch (err) {\n    if (err?.code === \"P2002\") {\n      return json({ error: \"Filename already exists. Delete it first or choose a new filename.\" }, { status: 409 });\n    }\n    console.error(\"Note upload error:\", err);\n    return json({ error: err?.message ?? \"Server error\" }, { status: 500 });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}