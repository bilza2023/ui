import{S as oe,i as fe,s as ae,n as H,d as p,f as v,e as D,o as b,J as z,j as T,k as C,q as V,l as P,v as O,U as re,N as ce,p as N,r as A,m as U,E as ue,G as J,F as me,B as he}from"./Z9DZtfMg.js";import"./IHki7fMi.js";import{e as q}from"./DtyEnmTo.js";function G(n){let e;return{c(){e=A("•")},l(t){e=N(t,"•")},m(t,l){D(t,e,l)},d(t){t&&p(e)}}}function F(n){let e=n[1]?"♥":"♡",t;return{c(){t=A(e)},l(l){t=N(l,e)},m(l,i){D(l,t,i)},p(l,i){i&2&&e!==(e=l[1]?"♥":"♡")&&U(t,e)},d(l){l&&p(t)}}}function W(n){let e;return{c(){e=A("Loading…")},l(t){e=N(t,"Loading…")},m(t,l){D(t,e,l)},d(t){t&&p(e)}}}function X(n){let e;return{c(){e=A("Saving…")},l(t){e=N(t,"Saving…")},m(t,l){D(t,e,l)},d(t){t&&p(e)}}}function K(n){let e=n[1]?"Liked":"Like",t;return{c(){t=A(e)},l(l){t=N(l,e)},m(l,i){D(l,t,i)},p(l,i){i&2&&e!==(e=l[1]?"Liked":"Like")&&U(t,e)},d(l){l&&p(t)}}}function Q(n){let e,t,l;return{c(){e=P("span"),t=A("· "),l=A(n[4]),this.h()},l(i){e=T(i,"SPAN",{class:!0});var f=C(e);t=N(f,"· "),l=N(f,n[4]),f.forEach(p),this.h()},h(){v(e,"class","status err svelte-io46jm")},m(i,f){D(i,e,f),b(e,t),b(e,l)},p(i,f){f&16&&U(l,i[4])},d(i){i&&p(e)}}}function Y(n){let e,t,l;return{c(){e=P("span"),t=A("· "),l=A(n[5]),this.h()},l(i){e=T(i,"SPAN",{class:!0});var f=C(e);t=N(f,"· "),l=N(f,n[5]),f.forEach(p),this.h()},h(){v(e,"class","status ok svelte-io46jm")},m(i,f){D(i,e,f),b(e,t),b(e,l)},p(i,f){f&32&&U(l,i[5])},d(i){i&&p(e)}}}function de(n){let e,t,l,i,f,o,u,y,L,E,g,S,j,w,a,s=n[2]&&G(),_=!n[2]&&F(n),m=n[2]&&W(),r=!n[2]&&n[3]&&X(),k=!n[2]&&!n[3]&&K(n),c=n[4]&&Q(n),h=!n[4]&&n[5]&&Y(n);return{c(){e=P("div"),t=P("button"),l=P("span"),s&&s.c(),i=O(),_&&_.c(),o=O(),u=P("span"),m&&m.c(),y=O(),r&&r.c(),L=O(),k&&k.c(),S=O(),c&&c.c(),j=O(),h&&h.c(),this.h()},l(d){e=T(d,"DIV",{class:!0,"aria-live":!0});var I=C(e);t=T(I,"BUTTON",{class:!0,"aria-pressed":!0,title:!0});var M=C(t);l=T(M,"SPAN",{class:!0,"data-state":!0});var R=C(l);s&&s.l(R),i=V(R),_&&_.l(R),R.forEach(p),o=V(M),u=T(M,"SPAN",{class:!0});var B=C(u);m&&m.l(B),y=V(B),r&&r.l(B),L=V(B),k&&k.l(B),B.forEach(p),M.forEach(p),S=V(I),c&&c.l(I),j=V(I),h&&h.l(I),I.forEach(p),this.h()},h(){v(l,"class","heart svelte-io46jm"),v(l,"data-state",f=n[1]?"on":"off"),v(u,"class","label svelte-io46jm"),v(t,"class","like-chip svelte-io46jm"),t.disabled=E=n[2]||n[3]||!n[0],v(t,"aria-pressed",n[1]),v(t,"title",g=n[1]?"Unlike":"Like"),v(e,"class","like-strip svelte-io46jm"),v(e,"aria-live","polite")},m(d,I){D(d,e,I),b(e,t),b(t,l),s&&s.m(l,null),b(l,i),_&&_.m(l,null),b(t,o),b(t,u),m&&m.m(u,null),b(u,y),r&&r.m(u,null),b(u,L),k&&k.m(u,null),b(e,S),c&&c.m(e,null),b(e,j),h&&h.m(e,null),w||(a=z(t,"click",n[6]),w=!0)},p(d,[I]){d[2]?s||(s=G(),s.c(),s.m(l,i)):s&&(s.d(1),s=null),d[2]?_&&(_.d(1),_=null):_?_.p(d,I):(_=F(d),_.c(),_.m(l,null)),I&2&&f!==(f=d[1]?"on":"off")&&v(l,"data-state",f),d[2]?m||(m=W(),m.c(),m.m(u,y)):m&&(m.d(1),m=null),!d[2]&&d[3]?r||(r=X(),r.c(),r.m(u,L)):r&&(r.d(1),r=null),!d[2]&&!d[3]?k?k.p(d,I):(k=K(d),k.c(),k.m(u,null)):k&&(k.d(1),k=null),I&13&&E!==(E=d[2]||d[3]||!d[0])&&(t.disabled=E),I&2&&v(t,"aria-pressed",d[1]),I&2&&g!==(g=d[1]?"Unlike":"Like")&&v(t,"title",g),d[4]?c?c.p(d,I):(c=Q(d),c.c(),c.m(e,j)):c&&(c.d(1),c=null),!d[4]&&d[5]?h?h.p(d,I):(h=Y(d),h.c(),h.m(e,null)):h&&(h.d(1),h=null)},i:H,o:H,d(d){d&&p(e),s&&s.d(),_&&_.d(),m&&m.d(),r&&r.d(),k&&k.d(),c&&c.d(),h&&h.d(),w=!1,a()}}}const Z="/api/like";function _e(n,e,t){let{contentId:l}=e,{initialLiked:i=!1}=e;const f=re();let o=!!i,u=!0,y=!1,L="",E="";function g(){try{return localStorage.getItem("token")}catch{return null}}function S(){t(4,L=""),t(5,E="")}ce(async()=>{if(!l){t(2,u=!1);return}const w=g();if(!w){t(2,u=!1),t(1,o=!!i);return}try{const a=await fetch(`${Z}?content_id=${encodeURIComponent(l)}`,{method:"GET",headers:{authorization:`Bearer ${w}`},credentials:"same-origin",cache:"no-store"}),s=await a.json().catch(()=>({}));a.ok&&(s!=null&&s.ok)?t(1,o=!!s.liked):a.status===401&&t(1,o=!!i)}catch{t(1,o=!!i)}finally{t(2,u=!1)}});async function j(){if(S(),!l){t(4,L="Missing contentId.");return}const w=g();if(!w){t(4,L="Please sign in to like.");return}t(3,y=!0);try{const a=await fetch(Z,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${w}`},body:JSON.stringify({content_id:l}),credentials:"same-origin"}),s=await a.json().catch(()=>({}));if(!a.ok||(s==null?void 0:s.ok)===!1){const _=new Error((s==null?void 0:s.message)||`HTTP ${a.status}`);throw _.code=(s==null?void 0:s.code)||"E_HTTP",_}t(1,o=!!s.liked),t(5,E=o?"Liked":"Removed"),f("changed",{liked:o})}catch(a){t(4,L=(a==null?void 0:a.message)||"Could not toggle like.")}finally{t(3,y=!1)}}return n.$$set=w=>{"contentId"in w&&t(0,l=w.contentId),"initialLiked"in w&&t(7,i=w.initialLiked)},[l,o,u,y,L,E,j,i]}class Ie extends oe{constructor(e){super(),fe(this,e,_e,de,ae,{contentId:0,initialLiked:7})}}function $(n,e,t){const l=n.slice();return l[12]=e[t],l}function x(n){let e;return{c(){e=A("Posting…")},l(t){e=N(t,"Posting…")},m(t,l){D(t,e,l)},d(t){t&&p(e)}}}function ee(n){let e;return{c(){e=A("Post Comment")},l(t){e=N(t,"Post Comment")},m(t,l){D(t,e,l)},d(t){t&&p(e)}}}function ke(n){let e,t="Sign in to post with your name.";return{c(){e=P("small"),e.textContent=t,this.h()},l(l){e=T(l,"SMALL",{class:!0,"data-svelte-h":!0}),he(e)!=="svelte-17wgfib"&&(e.textContent=t),this.h()},h(){v(e,"class","hint svelte-5iy1nb")},m(l,i){D(l,e,i)},d(l){l&&p(e)}}}function te(n){let e,t;return{c(){e=P("div"),t=A(n[3]),this.h()},l(l){e=T(l,"DIV",{class:!0});var i=C(e);t=N(i,n[3]),i.forEach(p),this.h()},h(){v(e,"class","err svelte-5iy1nb")},m(l,i){D(l,e,i),b(e,t)},p(l,i){i&8&&U(t,l[3])},d(l){l&&p(e)}}}function le(n){let e,t;return{c(){e=P("div"),t=A(n[4]),this.h()},l(l){e=T(l,"DIV",{class:!0});var i=C(e);t=N(i,n[4]),i.forEach(p),this.h()},h(){v(e,"class","msg svelte-5iy1nb")},m(l,i){D(l,e,i),b(e,t)},p(l,i){i&16&&U(t,l[4])},d(l){l&&p(e)}}}function ie(n){let e,t=q(n[5]),l=[];for(let i=0;i<t.length;i+=1)l[i]=ne($(n,t,i));return{c(){e=P("div");for(let i=0;i<l.length;i+=1)l[i].c();this.h()},l(i){e=T(i,"DIV",{class:!0});var f=C(e);for(let o=0;o<l.length;o+=1)l[o].l(f);f.forEach(p),this.h()},h(){v(e,"class","comments-list svelte-5iy1nb")},m(i,f){D(i,e,f);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null)},p(i,f){if(f&32){t=q(i[5]);let o;for(o=0;o<t.length;o+=1){const u=$(i,t,o);l[o]?l[o].p(u,f):(l[o]=ne(u),l[o].c(),l[o].m(e,null))}for(;o<l.length;o+=1)l[o].d(1);l.length=t.length}},d(i){i&&p(e),me(l,i)}}}function ne(n){let e,t,l=n[12].text+"",i,f,o,u=new Date(n[12].created_at).toLocaleString()+"",y,L;return{c(){e=P("div"),t=P("div"),i=A(l),f=O(),o=P("div"),y=A(u),L=O(),this.h()},l(E){e=T(E,"DIV",{class:!0});var g=C(e);t=T(g,"DIV",{class:!0});var S=C(t);i=N(S,l),S.forEach(p),f=V(g),o=T(g,"DIV",{class:!0});var j=C(o);y=N(j,u),j.forEach(p),L=V(g),g.forEach(p),this.h()},h(){v(t,"class","comment-text svelte-5iy1nb"),v(o,"class","comment-meta svelte-5iy1nb"),v(e,"class","comment-item svelte-5iy1nb")},m(E,g){D(E,e,g),b(e,t),b(t,i),b(e,f),b(e,o),b(o,y),b(e,L)},p(E,g){g&32&&l!==(l=E[12].text+"")&&U(i,l),g&32&&u!==(u=new Date(E[12].created_at).toLocaleString()+"")&&U(y,u)},d(E){E&&p(e)}}}function pe(n){let e,t,l,i,f,o,u,y,L=!n[7](),E,g,S,j,w,a=n[2]&&x(),s=!n[2]&&ee(),_=L&&ke(),m=n[3]&&te(n),r=n[4]&&le(n),k=n[5].length&&ie(n);return{c(){e=P("div"),t=P("textarea"),l=O(),i=P("div"),f=P("button"),a&&a.c(),o=O(),s&&s.c(),y=O(),_&&_.c(),E=O(),m&&m.c(),g=O(),r&&r.c(),S=O(),k&&k.c(),this.h()},l(c){e=T(c,"DIV",{class:!0});var h=C(e);t=T(h,"TEXTAREA",{rows:!0,placeholder:!0,class:!0}),C(t).forEach(p),l=V(h),i=T(h,"DIV",{class:!0});var d=C(i);f=T(d,"BUTTON",{class:!0});var I=C(f);a&&a.l(I),o=V(I),s&&s.l(I),I.forEach(p),y=V(d),_&&_.l(d),d.forEach(p),E=V(h),m&&m.l(h),g=V(h),r&&r.l(h),S=V(h),k&&k.l(h),h.forEach(p),this.h()},h(){v(t,"rows","3"),v(t,"placeholder","Write a comment…"),v(t,"class","svelte-5iy1nb"),v(f,"class","btn svelte-5iy1nb"),f.disabled=u=n[2]||!n[0]||!(n[1]||"").trim(),v(i,"class","actions svelte-5iy1nb"),v(e,"class","comment-panel svelte-5iy1nb")},m(c,h){D(c,e,h),b(e,t),J(t,n[1]),b(e,l),b(e,i),b(i,f),a&&a.m(f,null),b(f,o),s&&s.m(f,null),b(i,y),_&&_.m(i,null),b(e,E),m&&m.m(e,null),b(e,g),r&&r.m(e,null),b(e,S),k&&k.m(e,null),j||(w=[z(t,"input",n[9]),z(t,"input",n[6]),z(f,"click",n[8])],j=!0)},p(c,[h]){h&2&&J(t,c[1]),c[2]?a||(a=x(),a.c(),a.m(f,o)):a&&(a.d(1),a=null),c[2]?s&&(s.d(1),s=null):s||(s=ee(),s.c(),s.m(f,null)),h&7&&u!==(u=c[2]||!c[0]||!(c[1]||"").trim())&&(f.disabled=u),c[3]?m?m.p(c,h):(m=te(c),m.c(),m.m(e,g)):m&&(m.d(1),m=null),c[4]?r?r.p(c,h):(r=le(c),r.c(),r.m(e,S)):r&&(r.d(1),r=null),c[5].length?k?k.p(c,h):(k=ie(c),k.c(),k.m(e,null)):k&&(k.d(1),k=null)},i:H,o:H,d(c){c&&p(e),a&&a.d(),s&&s.d(),_&&_.d(),m&&m.d(),r&&r.d(),k&&k.d(),j=!1,ue(w)}}}const se="/api/comment";function be(n,e,t){let{contentId:l=null}=e,i="",f=!1,o="",u="",y=[];const L=re();function E(){t(3,o=""),t(4,u="")}function g(){try{return localStorage.getItem("token")||null}catch{return null}}async function S(){if(l)try{const a=await fetch(`${se}?content_id=${encodeURIComponent(l)}`),s=await a.json();a.ok&&(s!=null&&s.ok)&&t(5,y=s.comments||[])}catch(a){console.error("fetchComments error",a)}}async function j(){E();const a=(i??"").trim();if(!l){t(3,o="Missing contentId.");return}if(!a){t(3,o="Please write a comment first.");return}const s=g();if(!s){t(3,o="Please sign in to comment.");return}t(2,f=!0);try{const _={"content-type":"application/json",authorization:`Bearer ${s}`},m=await fetch(se,{method:"POST",headers:_,body:JSON.stringify({content_id:l,text:a})}),r=await m.json();if(!m.ok||(r==null?void 0:r.ok)===!1)throw new Error((r==null?void 0:r.message)||`HTTP ${m.status}`);t(4,u="Comment posted."),t(1,i=""),L("posted",{comment:r.comment}),await S()}catch(_){t(3,o=(_==null?void 0:_.message)||"Could not post comment.")}finally{t(2,f=!1)}}ce(S);function w(){i=this.value,t(1,i)}return n.$$set=a=>{"contentId"in a&&t(0,l=a.contentId)},[l,i,f,o,u,y,E,g,j,w]}class ye extends oe{constructor(e){super(),fe(this,e,be,pe,ae,{contentId:0})}}export{ye as C,Ie as L};
