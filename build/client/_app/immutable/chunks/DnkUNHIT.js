import{S,i as N,s as j,n as k,d as h,f as v,h as _,x as f,j as d,k as g,A as x,m as y,o as m,q as C,W as q,M as E,e as P,J as T,l as A,p as b}from"./MRdXX-TE.js";import"./IHki7fMi.js";import"./OBsGlrAT.js";function z(c){let t,l="Login",n,a,i="Register";return{c(){t=m("a"),t.textContent=l,n=C(),a=m("a"),a.textContent=i,this.h()},l(e){t=d(e,"A",{href:!0,class:!0,"data-svelte-h":!0}),x(t)!=="svelte-1ikv9w7"&&(t.textContent=l),n=y(e),a=d(e,"A",{href:!0,class:!0,"data-svelte-h":!0}),x(a)!=="svelte-8w1kkx"&&(a.textContent=i),this.h()},h(){f(t,"href","/login"),f(t,"class","pill svelte-fet60v"),f(a,"href","/register"),f(a,"class","pill svelte-fet60v")},m(e,u){v(e,t,u),v(e,n,u),v(e,a,u)},p:k,d(e){e&&(h(t),h(n),h(a))}}}function H(c){let t,l,n=c[1].email+"",a,i,e,u="Logout",p,o;return{c(){t=m("span"),l=b("Hi, "),a=b(n),i=C(),e=m("button"),e.textContent=u,this.h()},l(s){t=d(s,"SPAN",{class:!0});var r=g(t);l=A(r,"Hi, "),a=A(r,n),r.forEach(h),i=y(s),e=d(s,"BUTTON",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-4qezu6"&&(e.textContent=u),this.h()},h(){f(t,"class","hello svelte-fet60v"),f(e,"class","pill svelte-fet60v")},m(s,r){v(s,t,r),_(t,l),_(t,a),v(s,i,r),v(s,e,r),p||(o=T(e,"click",c[2]),p=!0)},p(s,r){r&2&&n!==(n=s[1].email+"")&&P(a,n)},d(s){s&&(h(t),h(i),h(e)),p=!1,o()}}}function U(c){let t,l="â€¦";return{c(){t=m("span"),t.textContent=l,this.h()},l(n){t=d(n,"SPAN",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-9s1gh8"&&(t.textContent=l),this.h()},h(){f(t,"class","muted svelte-fet60v")},m(n,a){v(n,t,a)},p:k,d(n){n&&h(t)}}}function B(c){let t,l,n="Taleem.help",a,i,e;function u(s,r){return s[0]?U:s[1]?H:z}let p=u(c),o=p(c);return{c(){t=m("nav"),l=m("a"),l.textContent=n,a=C(),i=m("span"),e=C(),o.c(),this.h()},l(s){t=d(s,"NAV",{class:!0});var r=g(t);l=d(r,"A",{class:!0,href:!0,"data-svelte-h":!0}),x(l)!=="svelte-19kz9hq"&&(l.textContent=n),a=y(r),i=d(r,"SPAN",{class:!0}),g(i).forEach(h),e=y(r),o.l(r),r.forEach(h),this.h()},h(){f(l,"class","brand svelte-fet60v"),f(l,"href","/"),f(i,"class","spacer svelte-fet60v"),f(t,"class","nav svelte-fet60v")},m(s,r){v(s,t,r),_(t,l),_(t,a),_(t,i),_(t,e),o.m(t,null)},p(s,[r]){p===(p=u(s))&&o?o.p(s,r):(o.d(1),o=p(s),o&&(o.c(),o.m(t,null)))},i:k,o:k,d(s){s&&h(t),o.d()}}}function w(){let c=null;try{c=localStorage.getItem("token")}catch{}return c?{authorization:`Bearer ${c}`}:{}}async function I(){const c=await fetch("/api/auth/verify",{headers:{accept:"application/json",...w()}});if(!c.ok)return null;const t=await c.json().catch(()=>({}));return(t==null?void 0:t.user)??null}async function L(){const c=await fetch("/studio",{headers:{accept:"application/json",...w()}});if(!c.ok)return 0;const t=await c.json().catch(()=>({}));return Array.isArray(t==null?void 0:t.messages)?t.messages.length:0}function M(c,t,l){const n=q();let a=!0,i=null,e=0;async function u(){l(0,a=!0),l(1,i=await I()),e=i?await L():0,l(0,a=!1),n("authchange",{user:i,unread:e})}E(u);async function p(){try{await fetch("/api/auth/logout",{method:"POST"})}catch{}try{localStorage.removeItem("token")}catch{}l(1,i=null),e=0,n("authchange",{user:null,unread:0}),location.reload()}return[a,i,p]}class R extends S{constructor(t){super(),N(this,t,M,B,j,{})}}export{R as N};
