import{S as fe,i as ae,s as re,n as H,d as _,r as he,F as J,b as y,c as k,B as R,v,e as C,f as N,h as V,j as D,k as j,Q as ce,C as ue,g as A,t as z,x as de,a as O,A as me}from"./DEZxJ6-q.js";import{e as q}from"./D9KMG8aj.js";import"./IHki7fMi.js";function F(i,e,t){const l=i.slice();return l[14]=e[t],l}function G(i){let e;return{c(){e=z("Posting…")},l(t){e=A(t,"Posting…")},m(t,l){y(t,e,l)},d(t){t&&_(e)}}}function Q(i){let e;return{c(){e=z("Post Comment")},l(t){e=A(t,"Post Comment")},m(t,l){y(t,e,l)},d(t){t&&_(e)}}}function W(i){let e,t="Sign in to post with your name.";return{c(){e=D("small"),e.textContent=t,this.h()},l(l){e=C(l,"SMALL",{class:!0,"data-svelte-h":!0}),de(e)!=="svelte-17wgfib"&&(e.textContent=t),this.h()},h(){v(e,"class","hint svelte-15oo2l3")},m(l,n){y(l,e,n)},d(l){l&&_(e)}}}function X(i){let e,t;return{c(){e=D("div"),t=z(i[4]),this.h()},l(l){e=C(l,"DIV",{class:!0});var n=N(e);t=A(n,i[4]),n.forEach(_),this.h()},h(){v(e,"class","err svelte-15oo2l3")},m(l,n){y(l,e,n),k(e,t)},p(l,n){n&16&&O(t,l[4])},d(l){l&&_(e)}}}function K(i){let e,t;return{c(){e=D("div"),t=z(i[5]),this.h()},l(l){e=C(l,"DIV",{class:!0});var n=N(e);t=A(n,i[5]),n.forEach(_),this.h()},h(){v(e,"class","msg svelte-15oo2l3")},m(l,n){y(l,e,n),k(e,t)},p(l,n){n&32&&O(t,l[5])},d(l){l&&_(e)}}}function Y(i){let e,t=q(i[6]),l=[];for(let n=0;n<t.length;n+=1)l[n]=Z(F(i,t,n));return{c(){e=D("div");for(let n=0;n<l.length;n+=1)l[n].c();this.h()},l(n){e=C(n,"DIV",{class:!0});var f=N(e);for(let r=0;r<l.length;r+=1)l[r].l(f);f.forEach(_),this.h()},h(){v(e,"class","comments-list svelte-15oo2l3")},m(n,f){y(n,e,f);for(let r=0;r<l.length;r+=1)l[r]&&l[r].m(e,null)},p(n,f){if(f&64){t=q(n[6]);let r;for(r=0;r<t.length;r+=1){const h=F(n,t,r);l[r]?l[r].p(h,f):(l[r]=Z(h),l[r].c(),l[r].m(e,null))}for(;r<l.length;r+=1)l[r].d(1);l.length=t.length}},d(n){n&&_(e),me(l,n)}}}function Z(i){let e,t,l=i[14].text+"",n,f,r,h=new Date(i[14].created_at).toLocaleString()+"",T,I;return{c(){e=D("div"),t=D("div"),n=z(l),f=j(),r=D("div"),T=z(h),I=j(),this.h()},l(g){e=C(g,"DIV",{class:!0});var b=N(e);t=C(b,"DIV",{class:!0});var L=N(t);n=A(L,l),L.forEach(_),f=V(b),r=C(b,"DIV",{class:!0});var S=N(r);T=A(S,h),S.forEach(_),I=V(b),b.forEach(_),this.h()},h(){v(t,"class","comment-text svelte-15oo2l3"),v(r,"class","comment-meta svelte-15oo2l3"),v(e,"class","comment-item svelte-15oo2l3")},m(g,b){y(g,e,b),k(e,t),k(t,n),k(e,f),k(e,r),k(r,T),k(e,I)},p(g,b){b&64&&l!==(l=g[14].text+"")&&O(n,l),b&64&&h!==(h=new Date(g[14].created_at).toLocaleString()+"")&&O(T,h)},d(g){g&&_(e)}}}function _e(i){let e,t,l,n,f,r,h,T,I,g,b,L,S,p=i[3]&&G(),E=!i[3]&&Q(),d=!i[1]&&W(),s=i[4]&&X(i),o=i[5]&&K(i),a=i[6].length&&Y(i);return{c(){e=D("div"),t=D("textarea"),l=j(),n=D("div"),f=D("button"),p&&p.c(),r=j(),E&&E.c(),T=j(),d&&d.c(),I=j(),s&&s.c(),g=j(),o&&o.c(),b=j(),a&&a.c(),this.h()},l(c){e=C(c,"DIV",{class:!0});var u=N(e);t=C(u,"TEXTAREA",{rows:!0,placeholder:!0,class:!0}),N(t).forEach(_),l=V(u),n=C(u,"DIV",{class:!0});var w=N(n);f=C(w,"BUTTON",{class:!0});var m=N(f);p&&p.l(m),r=V(m),E&&E.l(m),m.forEach(_),T=V(w),d&&d.l(w),w.forEach(_),I=V(u),s&&s.l(u),g=V(u),o&&o.l(u),b=V(u),a&&a.l(u),u.forEach(_),this.h()},h(){v(t,"rows","3"),v(t,"placeholder","Write a comment…"),v(t,"class","svelte-15oo2l3"),v(f,"class","btn svelte-15oo2l3"),f.disabled=h=i[3]||!i[0]||!(i[2]||"").trim(),v(n,"class","actions svelte-15oo2l3"),v(e,"class","comment-panel svelte-15oo2l3")},m(c,u){y(c,e,u),k(e,t),J(t,i[2]),k(e,l),k(e,n),k(n,f),p&&p.m(f,null),k(f,r),E&&E.m(f,null),k(n,T),d&&d.m(n,null),k(e,I),s&&s.m(e,null),k(e,g),o&&o.m(e,null),k(e,b),a&&a.m(e,null),L||(S=[R(t,"input",i[10]),R(t,"input",i[7]),R(f,"click",i[8])],L=!0)},p(c,[u]){u&4&&J(t,c[2]),c[3]?p||(p=G(),p.c(),p.m(f,r)):p&&(p.d(1),p=null),c[3]?E&&(E.d(1),E=null):E||(E=Q(),E.c(),E.m(f,null)),u&13&&h!==(h=c[3]||!c[0]||!(c[2]||"").trim())&&(f.disabled=h),c[1]?d&&(d.d(1),d=null):d||(d=W(),d.c(),d.m(n,null)),c[4]?s?s.p(c,u):(s=X(c),s.c(),s.m(e,g)):s&&(s.d(1),s=null),c[5]?o?o.p(c,u):(o=K(c),o.c(),o.m(e,b)):o&&(o.d(1),o=null),c[6].length?a?a.p(c,u):(a=Y(c),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:H,o:H,d(c){c&&_(e),p&&p.d(),E&&E.d(),d&&d.d(),s&&s.d(),o&&o.d(),a&&a.d(),L=!1,he(S)}}}const x="/api/comment";function ke(i,e,t){let{contentId:l=null}=e,{userId:n=null}=e,{authToken:f=null}=e,r="",h=!1,T="",I="",g=[];const b=ce();function L(){t(4,T=""),t(5,I="")}function S(){if(f)return f;try{return localStorage.getItem("token")||null}catch{return null}}async function p(){if(l)try{const s=await fetch(`${x}?content_id=${encodeURIComponent(l)}`),o=await s.json();s.ok&&(o!=null&&o.ok)&&t(6,g=o.comments||[])}catch(s){console.error("fetchComments error",s)}}async function E(){L();const s=(r??"").trim();if(!l){t(4,T="Missing contentId.");return}if(!s){t(4,T="Please write a comment first.");return}t(3,h=!0);try{const o={"content-type":"application/json"},a=S();a&&(o.authorization=`Bearer ${a}`);const c=await fetch(x,{method:"POST",headers:o,body:JSON.stringify({content_id:l,text:s})}),u=await c.json();if(!c.ok||(u==null?void 0:u.ok)===!1)throw new Error((u==null?void 0:u.message)||`HTTP ${c.status}`);t(5,I="Comment posted."),t(2,r=""),b("posted",{comment:u.comment}),await p()}catch(o){t(4,T=(o==null?void 0:o.message)||"Could not post comment."),S()||t(4,T="Please sign in to comment.")}finally{t(3,h=!1)}}ue(p);function d(){r=this.value,t(2,r)}return i.$$set=s=>{"contentId"in s&&t(0,l=s.contentId),"userId"in s&&t(1,n=s.userId),"authToken"in s&&t(9,f=s.authToken)},[l,n,r,h,T,I,g,L,E,f,d]}class Te extends fe{constructor(e){super(),ae(this,e,ke,_e,re,{contentId:0,userId:1,authToken:9})}}function $(i){let e;return{c(){e=z("•")},l(t){e=A(t,"•")},m(t,l){y(t,e,l)},d(t){t&&_(e)}}}function ee(i){let e=i[1]?"♥":"♡",t;return{c(){t=z(e)},l(l){t=A(l,e)},m(l,n){y(l,t,n)},p(l,n){n&2&&e!==(e=l[1]?"♥":"♡")&&O(t,e)},d(l){l&&_(t)}}}function te(i){let e;return{c(){e=z("Loading…")},l(t){e=A(t,"Loading…")},m(t,l){y(t,e,l)},d(t){t&&_(e)}}}function le(i){let e;return{c(){e=z("Saving…")},l(t){e=A(t,"Saving…")},m(t,l){y(t,e,l)},d(t){t&&_(e)}}}function ne(i){let e=i[1]?"Liked":"Like",t;return{c(){t=z(e)},l(l){t=A(l,e)},m(l,n){y(l,t,n)},p(l,n){n&2&&e!==(e=l[1]?"Liked":"Like")&&O(t,e)},d(l){l&&_(t)}}}function ie(i){let e,t,l;return{c(){e=D("span"),t=z("· "),l=z(i[4]),this.h()},l(n){e=C(n,"SPAN",{class:!0});var f=N(e);t=A(f,"· "),l=A(f,i[4]),f.forEach(_),this.h()},h(){v(e,"class","status err svelte-1oz6eu2")},m(n,f){y(n,e,f),k(e,t),k(e,l)},p(n,f){f&16&&O(l,n[4])},d(n){n&&_(e)}}}function se(i){let e,t,l;return{c(){e=D("span"),t=z("· "),l=z(i[5]),this.h()},l(n){e=C(n,"SPAN",{class:!0});var f=N(e);t=A(f,"· "),l=A(f,i[5]),f.forEach(_),this.h()},h(){v(e,"class","status ok svelte-1oz6eu2")},m(n,f){y(n,e,f),k(e,t),k(e,l)},p(n,f){f&32&&O(l,n[5])},d(n){n&&_(e)}}}function ge(i){let e,t,l,n,f,r,h,T,I,g,b,L,S,p,E,d=i[2]&&$(),s=!i[2]&&ee(i),o=i[2]&&te(),a=!i[2]&&i[3]&&le(),c=!i[2]&&!i[3]&&ne(i),u=i[4]&&ie(i),w=!i[4]&&i[5]&&se(i);return{c(){e=D("div"),t=D("button"),l=D("span"),d&&d.c(),n=j(),s&&s.c(),r=j(),h=D("span"),o&&o.c(),T=j(),a&&a.c(),I=j(),c&&c.c(),L=j(),u&&u.c(),S=j(),w&&w.c(),this.h()},l(m){e=C(m,"DIV",{class:!0,"aria-live":!0});var P=N(e);t=C(P,"BUTTON",{class:!0,"aria-pressed":!0,title:!0});var U=N(t);l=C(U,"SPAN",{class:!0,"data-state":!0});var M=N(l);d&&d.l(M),n=V(M),s&&s.l(M),M.forEach(_),r=V(U),h=C(U,"SPAN",{class:!0});var B=N(h);o&&o.l(B),T=V(B),a&&a.l(B),I=V(B),c&&c.l(B),B.forEach(_),U.forEach(_),L=V(P),u&&u.l(P),S=V(P),w&&w.l(P),P.forEach(_),this.h()},h(){v(l,"class","heart svelte-1oz6eu2"),v(l,"data-state",f=i[1]?"on":"off"),v(h,"class","label svelte-1oz6eu2"),v(t,"class","like-chip svelte-1oz6eu2"),t.disabled=g=i[2]||i[3]||!i[0],v(t,"aria-pressed",i[1]),v(t,"title",b=i[1]?"Unlike":"Like"),v(e,"class","like-strip svelte-1oz6eu2"),v(e,"aria-live","polite")},m(m,P){y(m,e,P),k(e,t),k(t,l),d&&d.m(l,null),k(l,n),s&&s.m(l,null),k(t,r),k(t,h),o&&o.m(h,null),k(h,T),a&&a.m(h,null),k(h,I),c&&c.m(h,null),k(e,L),u&&u.m(e,null),k(e,S),w&&w.m(e,null),p||(E=R(t,"click",i[6]),p=!0)},p(m,[P]){m[2]?d||(d=$(),d.c(),d.m(l,n)):d&&(d.d(1),d=null),m[2]?s&&(s.d(1),s=null):s?s.p(m,P):(s=ee(m),s.c(),s.m(l,null)),P&2&&f!==(f=m[1]?"on":"off")&&v(l,"data-state",f),m[2]?o||(o=te(),o.c(),o.m(h,T)):o&&(o.d(1),o=null),!m[2]&&m[3]?a||(a=le(),a.c(),a.m(h,I)):a&&(a.d(1),a=null),!m[2]&&!m[3]?c?c.p(m,P):(c=ne(m),c.c(),c.m(h,null)):c&&(c.d(1),c=null),P&13&&g!==(g=m[2]||m[3]||!m[0])&&(t.disabled=g),P&2&&v(t,"aria-pressed",m[1]),P&2&&b!==(b=m[1]?"Unlike":"Like")&&v(t,"title",b),m[4]?u?u.p(m,P):(u=ie(m),u.c(),u.m(e,S)):u&&(u.d(1),u=null),!m[4]&&m[5]?w?w.p(m,P):(w=se(m),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i:H,o:H,d(m){m&&_(e),d&&d.d(),s&&s.d(),o&&o.d(),a&&a.d(),c&&c.d(),u&&u.d(),w&&w.d(),p=!1,E()}}}const oe="/api/like";function be(i,e,t){let{contentId:l}=e,{userId:n=null}=e,{anchorId:f=null}=e,{initialLiked:r=!1}=e,{authToken:h=null}=e;const T=ce();let I=!!r,g=!0,b=!1,L="",S="";function p(){if(h)return h;try{return localStorage.getItem("token")||localStorage.getItem("jwt")||localStorage.getItem("authToken")||null}catch{return null}}function E(){t(4,L=""),t(5,S="")}ue(async()=>{if(!l){t(2,g=!1);return}const s=p();if(!s){t(2,g=!1),t(1,I=!!r);return}try{const o=await fetch(`${oe}?content_id=${encodeURIComponent(l)}`,{method:"GET",headers:{authorization:`Bearer ${s}`},credentials:"same-origin",cache:"no-store"}),a=await o.json().catch(()=>({}));o.ok&&(a!=null&&a.ok)?t(1,I=!!a.liked):o.status===401&&t(1,I=!!r)}catch{t(1,I=!!r)}finally{t(2,g=!1)}});async function d(){if(E(),!l){t(4,L="Missing contentId.");return}const s=p();if(!s){t(4,L="Please sign in to like.");return}t(3,b=!0);try{const o=await fetch(oe,{method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${s}`},body:JSON.stringify({content_id:l}),credentials:"same-origin"}),a=await o.json().catch(()=>({}));if(!o.ok||(a==null?void 0:a.ok)===!1){const c=new Error((a==null?void 0:a.message)||`HTTP ${o.status}`);throw c.code=(a==null?void 0:a.code)||"E_HTTP",c}t(1,I=!!a.liked),t(5,S=I?"Liked":"Removed"),T("changed",{liked:I})}catch(o){t(4,L=(o==null?void 0:o.message)||"Could not toggle like.")}finally{t(3,b=!1)}}return i.$$set=s=>{"contentId"in s&&t(0,l=s.contentId),"userId"in s&&t(7,n=s.userId),"anchorId"in s&&t(8,f=s.anchorId),"initialLiked"in s&&t(9,r=s.initialLiked),"authToken"in s&&t(10,h=s.authToken)},[l,I,g,b,L,S,d,n,f,r,h]}class Ee extends fe{constructor(e){super(),ae(this,e,be,ge,re,{contentId:0,userId:7,anchorId:8,initialLiked:9,authToken:10})}}export{Te as C,Ee as L};
