var H=s=>{throw TypeError(s)};var J=(s,t,e)=>t.has(s)||H("Cannot "+e);var M=(s,t,e)=>t.has(s)?H("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e);var B=(s,t,e)=>(J(s,t,"access private method"),e);import{S as K,i as X,s as x,d as p,o as C,p as g,q as v,Z as tt,b as y,w as D,c as A,x as O,h as $,e as S,f as U,y as E,k as L,j as P,z as V,N as et,V as st,n as I,B as nt,a as rt,g as it,t as at,Y as ot}from"../chunks/C5V-7dkx.js";import"../chunks/IHki7fMi.js";/* empty css                */import{L as ct,C as lt}from"../chunks/qvxQi2uu.js";import{z as ut,h as dt,f as w,g as ht,c as Q,T as ft,N as _t}from"../chunks/Dp9Uq9nb.js";import"../chunks/CqL6qkBr.js";var b,j,R;class N{static validate(t){const e=ut.safeParse(t);return e.success?{ok:!0,value:e.data}:{ok:!1,errors:e.error.issues}}static build(t){let e=structuredClone(t);return e=B(this,b,j).call(this,e),e=B(this,b,R).call(this,e),e}static checkTimings(t){}static getTotalDuration(t){}static slideAtTime(t,e){}static toStaticBackground(t){}static withoutSound(t){}static flattenEQ(t){}static diff(t,e){}static isDeckV1(t){return t&&t.version==="deck-v1"&&Array.isArray(t.deck)}}b=new WeakSet,j=function(t){const e={backgroundColor:"#F3E5AB",backgroundImage:"/images/taleem.webp",backgroundImageOpacity:.07};return{...t,background:t.background||e}},R=function(t){const e=Array.isArray(t.deck)?t.deck:[];return t.deck=e.map(n=>{if(n.type!=="eq")return n;const i=[];let r=null;return n.data.forEach(c=>{if(c.sp!==void 0&&Object.keys(c.sp).length===0){r=null;return}if(typeof c.type=="string"&&c.type.startsWith("sp")){r??(r=[]),r.push({type:c.type,content:c.content});return}const h={name:"line",type:c.type,content:c.content,showAt:c.showAt,spItems:r?structuredClone(r):void 0};i.push(h)}),{...n,data:i}}),t},M(N,b);class pt{constructor(t){this.sound=new dt.Howl({src:[t],html5:!0}),this._tickCbs=[],this._intervalId=null,this.sound.on("play",()=>this._startTickLoop()),this.sound.on("pause",()=>this._clearTickLoop()),this.sound.on("stop",()=>this._clearTickLoop()),this.sound.on("end",()=>this._clearTickLoop())}play(){this.sound.playing()||this.sound.play()}seek(t){this.sound.seek(t)}pause(){this.sound.pause()}onTick(t,e=200){this._tickCbs.push(t),this.sound.playing()&&!this._intervalId&&this._startTickLoop(e)}_startTickLoop(t=200){this._intervalId||(this._intervalId=setInterval(()=>{const e=this.sound.seek();this._tickCbs.forEach(n=>n(e))},t))}_clearTickLoop(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)}destroy(){this._clearTickLoop(),this.sound.unload()}}class kt{constructor(){this._tickCbs=[],this._interval=200,this._intervalId=null,this._elapsed=0,this._startedAt=null}play(){this._intervalId||(this._startedAt=Date.now(),this._startTickLoop(this._interval))}pause(){this._intervalId&&(this._elapsed+=Date.now()-this._startedAt,this._clearTickLoop())}onTick(t,e=200){this._tickCbs.push(t),this._interval=e,this._startedAt&&!this._intervalId&&this._startTickLoop(e)}destroy(){this._clearTickLoop()}seek(t){this._elapsed=t*1e3,this._startedAt=Date.now()}_currentTime(){const t=this._startedAt?Date.now()-this._startedAt:0;return(this._elapsed+t)/1e3}_startTickLoop(t){this._clearTickLoop(),this._intervalId=setInterval(()=>{const e=this._currentTime();this._tickCbs.forEach(n=>n(e))},t)}_clearTickLoop(){this._intervalId&&(clearInterval(this._intervalId),this._intervalId=null)}}function mt(s){return s?new pt(s):new kt}async function gt(s,t=globalThis.fetch){try{return!!(await t(s,{method:"HEAD",cache:"no-store"})).ok}catch{return!1}}async function vt(s,t=globalThis.fetch){if(!s)return null;const e=`/media/sounds/${s}.opus`;return await gt(e,t)?e:null}function bt(s){let t,e,n,i;return t=new ft({props:{deck:s[1],currentTime:s[3]}}),n=new _t({props:{currentTime:s[3],currentSlideIndex:s[4],deckEnd:s[6],soundUrl:s[2],onPlay:s[7],onPause:s[8],onStop:s[10],onSeek:s[9]}}),{c(){V(t.$$.fragment),e=L(),V(n.$$.fragment)},l(r){E(t.$$.fragment,r),e=$(r),E(n.$$.fragment,r)},m(r,c){D(t,r,c),y(r,e,c),D(n,r,c),i=!0},p(r,c){const h={};c&2&&(h.deck=r[1]),c&8&&(h.currentTime=r[3]),t.$set(h);const f={};c&8&&(f.currentTime=r[3]),c&16&&(f.currentSlideIndex=r[4]),c&4&&(f.soundUrl=r[2]),n.$set(f)},i(r){i||(v(t.$$.fragment,r),v(n.$$.fragment,r),i=!0)},o(r){g(t.$$.fragment,r),g(n.$$.fragment,r),i=!1},d(r){r&&p(e),C(t,r),C(n,r)}}}function Tt(s){let t,e;return{c(){t=P("div"),e=at(s[0]),this.h()},l(n){t=S(n,"DIV",{class:!0});var i=U(t);e=it(i,s[0]),i.forEach(p),this.h()},h(){O(t,"class","center error svelte-1ihtpwz")},m(n,i){y(n,t,i),A(t,e)},p(n,i){i&1&&rt(e,n[0])},i:I,o:I,d(n){n&&p(t)}}}function It(s){let t,e="Loadingâ€¦";return{c(){t=P("div"),t.textContent=e,this.h()},l(n){t=S(n,"DIV",{class:!0,"data-svelte-h":!0}),nt(t)!=="svelte-y7ce8"&&(t.textContent=e),this.h()},h(){O(t,"class","center svelte-1ihtpwz")},m(n,i){y(n,t,i)},p:I,i:I,o:I,d(n){n&&p(t)}}}function yt(s){let t,e,n,i,r,c,h,f,d,k;const m=[It,Tt,bt],a=[];function _(o,u){return o[0]?1:2}return t=_(s),e=a[t]=m[t](s),r=new ct({props:{contentId:s[5]}}),d=new lt({props:{contentId:s[5]}}),{c(){e.c(),n=L(),i=P("div"),V(r.$$.fragment),c=L(),h=P("hr"),f=L(),V(d.$$.fragment),this.h()},l(o){e.l(o),n=$(o),i=S(o,"DIV",{class:!0});var u=U(i);E(r.$$.fragment,u),c=$(u),h=S(u,"HR",{}),f=$(u),E(d.$$.fragment,u),u.forEach(p),this.h()},h(){O(i,"class","bg-[#594112]")},m(o,u){a[t].m(o,u),y(o,n,u),y(o,i,u),D(r,i,null),A(i,c),A(i,h),A(i,f),D(d,i,null),k=!0},p(o,[u]){let T=t;t=_(o),t===T?a[t].p(o,u):(ot(),g(a[T],1,1,()=>{a[T]=null}),tt(),e=a[t],e?e.p(o,u):(e=a[t]=m[t](o),e.c()),v(e,1),e.m(n.parentNode,n))},i(o){k||(v(e),v(r.$$.fragment,o),v(d.$$.fragment,o),k=!0)},o(o){g(e),g(r.$$.fragment,o),g(d.$$.fragment,o),k=!1},d(o){o&&(p(n),p(i)),a[t].d(o),C(r),C(d)}}}function wt(s,t,e){var q,F;let{data:n}=t;const{meta:i,deckRaw:r}=n;let c=null,h=(i==null?void 0:i.filename)??"",f=null,d=[],k=null;try{const l=Array.isArray(r)?{version:"deck-v1",deck:r}:r,G=N.build(l),z=N.validate(G);z.ok?(f=z.value,d=f.deck||[],k=f.background??null):c=((F=(q=z.errors)==null?void 0:q[0])==null?void 0:F.message)||"Invalid deck"}catch(l){c=(l==null?void 0:l.message)||"Failed to prepare deck"}let m=null,a=null,_=0,o=w(d,0),u=ht(d);function T(){var l;(l=a==null?void 0:a.play)==null||l.call(a)}function W(){var l;(l=a==null?void 0:a.pause)==null||l.call(a)}function Y(l){a&&(a.seek(l),e(3,_=Q(d,l)),e(4,o=w(d,_)))}function Z(){a&&(a.pause(),a.seek(0),e(3,_=0),e(4,o=w(d,0)))}return et(async()=>{try{e(2,m=await vt(h,fetch)),a=mt(m),a.onTick(l=>{e(3,_=Q(d,l)),e(4,o=w(d,_)),_>=u&&(e(3,_=u),a.pause())})}catch{}}),st(()=>{var l;(l=a==null?void 0:a.destroy)==null||l.call(a)}),s.$$set=l=>{"data"in l&&e(11,n=l.data)},[c,d,m,_,o,h,u,T,W,Y,Z,n]}class Pt extends K{constructor(t){super(),X(this,t,wt,yt,x,{data:11})}}export{Pt as component};
